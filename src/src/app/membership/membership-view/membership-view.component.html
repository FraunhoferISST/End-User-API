<!--
    Copyright (c) 2025 Fraunhofer-Gesellschaft zur Förderung der angewandten Forschung e.V.

    This program and the accompanying materials are made available under the
    terms of the Apache License, Version 2.0 which is available at
    https://www.apache.org/licenses/LICENSE-2.0

    SPDX-License-Identifier: Apache-2.0

    Contributors:
         Fraunhofer-Gesellschaft zur Förderung der angewandten Forschung e.V. - initial API and implementation
-->
<div class="flex flex-col max-h-full">

  @if ((membershipService.memberships$ | async)!.length > 0) {
    <div class="flex-row flex-nowrap flex mb-4">
      <lib-filter-input
        placeholder="Filter for ID or Ecosystem ..."
        [focusShortcut]="['Alt', 'j']"
        class="mr-4 grow"
        (inputChange)="filter($event)"
      ></lib-filter-input>
      <button
        class="mr-4 btn btn-lg btn-primary rounded-2xl btn-soft shadow-xl !text-sm border-none"
        (click)="addMembership()"
      >
        <span class="material-symbols-rounded">add</span>
        Add
      </button>
      <lib-item-count-selector
        class="mr-4"
        [currentItemCount]="pageItemCount"
        (itemCountChanged)="pageItemCount = $event"
      ></lib-item-count-selector>
      <lib-pagination
        [items]="filteredMemberships$ | async"
        [pageItemCount]="pageItemCount"
        (pageItems)="paginationEvent($event)"
        class="shadow-xl rounded-2xl bg-base-300 [&_button:hover]:bg-base-100 [&_.join>button]:first:rounded-l-2xl [&_.join>button]:last:rounded-r-2xl"
      ></lib-pagination>
    </div>

    <div class="overflow-y-auto box-content -mx-8 px-8 -mb-4 pb-4 grid w-full gap-4 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5">
      @for (membership of pageMemberships$ | async; track membership.id) {
        <div class="card grow bg-base-300 rounded-2xl shadow-lg">
          <div class="card-body">
            <div class="card-title mb-3">
              <span class="material-symbols-rounded !text-3xl"
                    [ngClass]="{
                      'text-warning': membership.status === 'pending',
                      'text-success': membership.status === 'active',
                      'text-error': membership.status === 'expired'
                    }"
              >card_membership</span>
              <span class="truncate text-wrap">{{ membership.ecosystem | titlecase }}</span>
            </div>
            <div class="ml-3 mb-3 grid grid-cols-[minmax(0,auto)_minmax(0,min-content)] gap-2">
              <div class="flex items-center">
                <span class="material-symbols-rounded mr-1 text-info/50">
                  @switch (membership.status) {
                    @case ('pending') { pending }
                    @case ('active') { check_circle }
                    @case ('expired') { cancel }
                    @default { question_mark }
                  }
                </span>
                <b><i>Status</i></b>
              </div>
              <span [ngClass]="{
                  'text-warning': membership.status === 'pending',
                  'text-success': membership.status === 'active',
                  'text-error': membership.status === 'expired'
                }"
              >{{ membership.status | titlecase }}</span>
              <div class="flex items-center">
                <span class="material-symbols-rounded mr-1 text-info/50">identity_platform</span>
                <b><i>ID</i></b>
              </div>
              <span>{{ membership.id }}</span>
              @if (membership.since) {
                <div class="flex items-center">
                  <span class="material-symbols-rounded mr-1 text-info/50">date_range</span>
                  <b><i>Since</i></b>
                </div>
                <span class="truncate">{{ membership.since.toUTCString() | date: 'yyyy-MM-dd' }}</span>
              }
              @if (membership.until) {
                <div class="flex items-center">
                  <span class="material-symbols-rounded mr-1 text-info/50">date_range</span>
                  <b><i>Until</i></b>
                </div>
                <span class="truncate">{{ membership.until.toUTCString() | date: 'yyyy-MM-dd' }}</span>
              }
            </div>
          </div>
        </div>
      }
    </div>
  } @else {
    <div class="max-h-full w-full lg:px-[15%] xl:px-[25%] flex flex-col items-center justify-center overflow-hidden">
      <div class="alert alert-info w-full mt-8 flex-shrink-0">
        <span class="material-symbols-rounded">settings_alert</span>
        <span>You are not yet connected to any ecosystem! Connect to one below.</span>
      </div>
      <div class="divider mb-12 mt-8 flex-shrink-0">Connect to your first ecosystem</div>
      <app-registration class="overflow-y-auto min-h-0 flex-1"></app-registration>
    </div>
  }

</div>
