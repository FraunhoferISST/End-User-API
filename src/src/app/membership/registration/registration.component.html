<div class="flex flex-col items-center justify-start w-full max-w-2xl mx-auto p-4">

  <!-- Dynamic Steps Indicator -->
  <ul class="steps mb-8 w-full">
    @for (step of steps; track step.name) {
      <li
        class="step"
        [class.step-primary]="step.active || step.completed"
        [attr.data-content]="step.completed ? '✓' : (step.active ? '●' : '')">
        {{ step.name }}
      </li>
    }
  </ul>

  <!-- Step 1: Ecosystem Selection -->
  @if (currentStep === 1) {
    <div class="card bg-base-200 w-full">
      <div class="card-body">
        <h2 class="card-title text-2xl mb-4">Select your ecosystem</h2>

        <div class="form-control w-full mb-6">
          <label class="label">
            <span class="label-text">Ecosystem</span>
          </label>
          <select
            class="select select-bordered select-lg w-full"
            [(ngModel)]="selectedEcosystem">
            <option value="" disabled>Select ecosystem...</option>
            <option value="catena-x">Catena-X</option>
            <option value="ecosystem-2">Ecosystem 2</option>
            <option value="ecosystem-3">Ecosystem 3</option>
            <option value="ecosystem-4">Ecosystem 4</option>
          </select>
        </div>

        @if (selectedEcosystem) {
          <div class="form-control w-full">
            <label class="label">
              <span class="label-text">Membership Type</span>
            </label>
            <div class="flex flex-col gap-3">
              <label class="label cursor-pointer justify-start gap-4 p-4 border rounded-lg hover:bg-base-300"
                     [class.border-primary]="membershipType === 'existing'"
                     [class.bg-base-300]="membershipType === 'existing'">
                <input
                  type="radio"
                  name="membershipType"
                  class="radio radio-primary"
                  [value]="'existing'"
                  [(ngModel)]="membershipType"/>
                <div>
                  <span class="label-text font-semibold">Add existing membership</span>
                  <p class="text-sm opacity-70">I already have a membership ID</p>
                </div>
              </label>

              <label class="label cursor-pointer justify-start gap-4 p-4 border rounded-lg hover:bg-base-300"
                     [class.border-primary]="membershipType === 'new'"
                     [class.bg-base-300]="membershipType === 'new'">
                <input
                  type="radio"
                  name="membershipType"
                  class="radio radio-primary"
                  [value]="'new'"
                  [(ngModel)]="membershipType"/>
                <div>
                  <span class="label-text font-semibold">Apply for new membership</span>
                  <p class="text-sm opacity-70">Register as a new member</p>
                </div>
              </label>
            </div>
          </div>
        }
      </div>
    </div>
  }

  <!-- Step 2: Input -->
  @if (currentStep === 2) {
    <div class="card bg-base-200 w-full">
      <div class="card-body">

        <!-- Existing Membership -->
        @if (membershipType === 'existing') {
          <h2 class="card-title text-2xl mb-4">Enter your Membership ID</h2>

          <div class="form-control w-full">
            <label class="label">
              <span class="label-text">Membership ID</span>
            </label>
            <input
              type="text"
              placeholder="e.g., MEM-2024-XXXXX"
              class="input input-bordered input-lg w-full"
              [(ngModel)]="existingMembershipId"/>
            <label class="label">
              <span class="label-text-alt">Enter the membership ID you received</span>
            </label>
          </div>
        }

        <!-- New Membership - Company Data -->
        @if (membershipType === 'new') {
          <h2 class="card-title text-2xl mb-4">Company Information</h2>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- Legal Name -->
            <div class="form-control w-full md:col-span-2">
              <label class="label">
                <span class="label-text">Legal Company Name *</span>
              </label>
              <input
                type="text"
                placeholder="Full legal name"
                class="input input-bordered w-full"
                [(ngModel)]="companyData.legalName"/>
            </div>

            <!-- Short Name -->
            <div class="form-control w-full md:col-span-2">
              <label class="label">
                <span class="label-text">Short Name *</span>
              </label>
              <input
                type="text"
                placeholder="Company short name"
                class="input input-bordered w-full"
                [(ngModel)]="companyData.shortName"/>
            </div>

            <div class="divider md:col-span-2">Address</div>

            <!-- Street -->
            <div class="form-control w-full md:col-span-2">
              <label class="label">
                <span class="label-text">Street Address *</span>
              </label>
              <input
                type="text"
                placeholder="Street and number"
                class="input input-bordered w-full"
                [(ngModel)]="companyData.street"/>
            </div>

            <!-- City -->
            <div class="form-control w-full">
              <label class="label">
                <span class="label-text">City *</span>
              </label>
              <input
                type="text"
                placeholder="City"
                class="input input-bordered w-full"
                [(ngModel)]="companyData.city"/>
            </div>

            <!-- Postal Code -->
            <div class="form-control w-full">
              <label class="label">
                <span class="label-text">Postal Code *</span>
              </label>
              <input
                type="text"
                placeholder="Postal code"
                class="input input-bordered w-full"
                [(ngModel)]="companyData.postalCode"/>
            </div>

            <!-- Country -->
            <div class="form-control w-full md:col-span-2">
              <label class="label">
                <span class="label-text">Country *</span>
              </label>
              <select
                class="select select-bordered w-full"
                [(ngModel)]="companyData.country">
                <option value="" disabled>Select country...</option>
                <option value="DE">Germany</option>
                <option value="FR">France</option>
                <option value="IT">Italy</option>
                <option value="ES">Spain</option>
                <option value="NL">Netherlands</option>
                <option value="AT">Austria</option>
                <option value="CH">Switzerland</option>
              </select>
            </div>

            <div class="divider md:col-span-2">Registration</div>

            <!-- Commercial Registration Number -->
            <div class="form-control w-full md:col-span-2">
              <label class="label">
                <span class="label-text">Commercial Registration Number *</span>
              </label>
              <input
                type="text"
                placeholder="e.g., HRB 12345"
                class="input input-bordered w-full"
                [(ngModel)]="companyData.commercialRegistrationNumber"/>
              <label class="label">
                <span class="label-text-alt">As registered in your country's commercial register</span>
              </label>
            </div>
          </div>
        }
      </div>
    </div>
  }

  <!-- Step 3: Proof (only for new membership) -->
  @if (currentStep === 3 && membershipType === 'new') {
    <div class="card bg-base-200 w-full">
      <div class="card-body">
        <h2 class="card-title text-2xl mb-4">Upload Proof Documents</h2>

        <div class="alert alert-info mb-4">
          <span class="material-symbols-rounded">info</span>
          <span>Please upload documents to verify your company information</span>
        </div>

        <div class="space-y-4">
          <div class="form-control w-full">
            <label class="label">
              <span class="label-text">Commercial Register Extract</span>
            </label>
            <input
              type="file"
              class="file-input file-input-bordered w-full"
              accept=".pdf,.jpg,.png"/>
            <label class="label">
              <span class="label-text-alt">PDF or image, max 10MB</span>
            </label>
          </div>

          <div class="form-control w-full">
            <label class="label">
              <span class="label-text">Additional Documents (optional)</span>
            </label>
            <input
              type="file"
              class="file-input file-input-bordered w-full"
              accept=".pdf,.jpg,.png"
              multiple/>
          </div>
        </div>
      </div>
    </div>
  }

  <!-- Step 4: Agree (only for new membership) -->
  @if (currentStep === 4 && membershipType === 'new') {
    <div class="card bg-base-200 w-full">
      <div class="card-body">
        <h2 class="card-title text-2xl mb-4">Terms & Agreements</h2>

        <div class="space-y-4">
          <div class="form-control">
            <label class="label cursor-pointer justify-start gap-4">
              <input
                type="checkbox"
                class="checkbox checkbox-primary"
                [(ngModel)]="agreedToTerms"/>
              <span class="label-text">
                I have read and agree to the
                <a href="#" class="link link-primary">Terms of Service</a>
                and
                <a href="#" class="link link-primary">Membership Agreement</a>
              </span>
            </label>
          </div>

          <div class="form-control">
            <label class="label cursor-pointer justify-start gap-4">
              <input
                type="checkbox"
                class="checkbox checkbox-primary"
                [(ngModel)]="agreedToPrivacy"/>
              <span class="label-text">
                I agree to the
                <a href="#" class="link link-primary">Privacy Policy</a>
                and consent to the processing of my data
              </span>
            </label>
          </div>
        </div>

        <div class="alert alert-info mt-4">
          <span class="material-symbols-rounded">info</span>
          <span>Your application will be reviewed within 5 business days</span>
        </div>
      </div>
    </div>
  }

  <!-- Submit Step -->
  @if (isSubmitStep()) {
    <div class="card bg-base-200 w-full">
      <div class="card-body">
        @if (!isSubmitted) {
          <h2 class="card-title text-2xl mb-4">Review & Submit</h2>

          <!-- Summary -->
          <div class="bg-base-100 rounded-lg p-4 space-y-3">
            <div class="flex justify-between">
              <span class="font-semibold">Ecosystem:</span>
              <span>{{ selectedEcosystem }}</span>
            </div>
            <div class="flex justify-between">
              <span class="font-semibold">Type:</span>
              <span class="badge" [class.badge-info]="membershipType === 'existing'" [class.badge-success]="membershipType === 'new'">
                {{ membershipType === 'existing' ? 'Existing Membership' : 'New Application' }}
              </span>
            </div>

            @if (membershipType === 'existing') {
              <div class="flex justify-between">
                <span class="font-semibold">Membership ID:</span>
                <span class="font-mono">{{ existingMembershipId }}</span>
              </div>
            }

            @if (membershipType === 'new') {
              <div class="divider">Company Details</div>
              <div class="flex justify-between">
                <span class="font-semibold">Company:</span>
                <span>{{ companyData.legalName }} ({{ companyData.shortName }})</span>
              </div>
              <div class="flex justify-between">
                <span class="font-semibold">Address:</span>
                <span>{{ companyData.street }}, {{ companyData.postalCode }} {{ companyData.city }}</span>
              </div>
              <div class="flex justify-between">
                <span class="font-semibold">Registration No:</span>
                <span class="font-mono">{{ companyData.commercialRegistrationNumber }}</span>
              </div>
            }
          </div>
        } @else {
          <!-- Success Message -->
          <div class="text-center py-8">
            <div class="text-6xl mb-4">✅</div>
            <h2 class="text-2xl font-bold text-success mb-2">
              {{ membershipType === 'existing' ? 'Membership Added!' : 'Application Submitted!' }}
            </h2>
            <p class="opacity-70">
              @if (membershipType === 'existing') {
                Your membership has been successfully linked to your account.
              } @else {
                Your application is being reviewed. You will receive a confirmation email shortly.
              }
            </p>
          </div>
        }
      </div>
    </div>
  }

  <!-- Navigation Buttons -->
  <div class="flex justify-between w-full mt-6">
    @if (currentStep > 1 && !isSubmitted) {
      <button
        class="btn btn-outline"
        (click)="previousStep()">
        ← Previous
      </button>
    } @else {
      <div></div>
    }

    @if (!isSubmitted) {
      @if (isSubmitStep()) {
        <button
          class="btn btn-primary"
          [disabled]="isSubmitting"
          (click)="submit()">
          @if (isSubmitting) {
            <span class="loading loading-spinner"></span>
            Submitting...
          } @else {
            Submit
          }
        </button>
      } @else {
        <button
          class="btn btn-primary"
          [disabled]="!canProceed()"
          (click)="nextStep()">
          Next →
        </button>
      }
    } @else {
      <button
        class="btn btn-primary"
        (click)="reset()">
        Start New Registration
      </button>
    }
  </div>
</div>
